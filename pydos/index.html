<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PY-DOS Web Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
        }
        
        #terminal {
            width: 100%;
            height: 100vh;
            padding: 20px;
            overflow-y: auto;
            background-color: #000;
        }
        
        #output {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 10px;
        }
        
        .input-line {
            display: flex;
            align-items: baseline;
            margin-top: 5px;
        }
        
        .prompt {
            color: #0f0;
            margin-right: 5px;
            white-space: nowrap;
        }
        
        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            outline: none;
            caret-color: #0f0;
        }
        
        .ascii-art {
            color: #fff;
            text-shadow: 0 0 10px #0f0;
            margin-bottom: 20px;
        }
        
        .line {
            margin: 2px 0;
        }
        
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #111;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #0f0;
        }
        
        .error {
            color: #f00;
        }
        
        .success {
            color: #0ff;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <pre class="ascii-art">                            ██████╗ ██╗   ██╗    ██████╗  ██████╗ ███████╗
                            ██╔══██╗╚██╗ ██╔╝    ██╔══██╗██╔═══██╗██╔════╝
                            ██████╔╝ ╚████╔╝     ██║  ██║██║   ██║███████╗
                            ██╔═══╝   ╚██╔╝      ██║  ██║██║   ██║╚════██║
                            ██║        ██║       ██████╔╝╚██████╔╝███████║
                            ╚═╝        ╚═╝       ╚═════╝  ╚═════╝ ╚══════╝</pre>
        <div class="line">PY DOS [Version Web 1.0]</div>
        <div class="line">ENTER 'help' TO GET STARTED.</div>
        <div class="line">Data persists in browser localStorage</div>
        <div class="line"></div>
        <div id="output"></div>
        <div class="input-line">
            <span class="prompt" id="prompt">PY DOS \&gt; </span>
            <input type="text" id="command-input" autofocus autocomplete="off">
        </div>
    </div>

    <script>
        // Filesystem state
        let filesystem = {
            '/': {
                type: 'directory',
                contents: {
                    'bin': { type: 'directory', contents: {} },
                    'usr': { type: 'directory', contents: {} },
                    'tmp': { type: 'directory', contents: {} }
                }
            }
        };
        
        let fileContents = {};
        let currentDir = '/';
        let commandHistory = [];
        let historyIndex = -1;
        let multilineMode = false;
        let multilineBuffer = [];
        let multilineFilename = '';
        let multilineType = '';
        
        const output = document.getElementById('output');
        const commandInput = document.getElementById('command-input');
        const promptElement = document.getElementById('prompt');
        const terminal = document.getElementById('terminal');
        
        // Load from localStorage on start
        loadFromStorage();
        
        // Focus input on click
        terminal.addEventListener('click', () => commandInput.focus());
        
        // Handle input
        commandInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const command = commandInput.value.trim();
                
                if (multilineMode) {
                    if (command === '\\s') {
                        saveMultilineFile();
                        multilineMode = false;
                        multilineBuffer = [];
                        updatePrompt();
                    } else {
                        multilineBuffer.push(command);
                        addOutput(command);
                    }
                    commandInput.value = '';
                } else {
                    addOutput(`${promptElement.textContent}${command}`);
                    commandInput.value = '';
                    
                    if (command) {
                        commandHistory.push(command);
                        historyIndex = commandHistory.length;
                        executeCommand(command);
                    } else {
                        updatePrompt();
                    }
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    commandInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    commandInput.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    commandInput.value = '';
                }
            }
        });
        
        function executeCommand(command) {
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1).join(' ');
            
            switch(cmd) {
                case 'help':
                case '?':
                    showHelp();
                    break;
                case 'ls':
                case 'dir':
                    listDirectory();
                    break;
                case 'cd':
                    changeDirectory(args);
                    break;
                case 'mkdir':
                case 'md':
                    makeDirectory(args);
                    break;
                case 'rmdir':
                case 'rd':
                    removeDirectory(args);
                    break;
                case 'mktf':
                case 'touch':
                    createTextFile(args);
                    break;
                case 'mkef':
                    createExeFile(args);
                    break;
                case 'vwtf':
                case 'cat':
                case 'type':
                    viewFile(args);
                    break;
                case 'rm':
                case 'del':
                    removeFile(args);
                    break;
                case 'copy':
                    copyFile(args);
                    break;
                case 'move':
                    moveFile(args);
                    break;
                case 'rem':
                case 'ren':
                    renameFile(args);
                    break;
                case 'edit':
                    editFile(args);
                    break;
                case 'run':
                    addOutput('<span class="error">Code execution not available in browser version</span>');
                    break;
                case 'clear':
                case 'cls':
                    output.innerHTML = '';
                    break;
                case 'format':
                    formatFilesystem();
                    break;
                default:
                    addOutput(`<span class="error">'${cmd}' is not recognized as an internal or external command</span>`);
            }
            
            updatePrompt();
            scrollToBottom();
            saveToStorage();
        }
        
        function showHelp() {
            addOutput(`
    AVAILABLE COMMANDS:
    cd        - changes directory
    mkdir     - creates a directory
    rmdir     - removes a directory
    ls        - lists directory contents
    mktf      - creates text files
    mkef      - creates executable files
    rm        - removes files
    vwtf      - shows file contents
    copy      - copies files to another directory
    move      - moves files to another directory
    rem       - renames files
    edit      - edits existing files
    clear     - clears terminal
    format    - resets filesystem`);
        }
        
        function listDirectory() {
            if (!filesystem[currentDir]) {
                addOutput('<span class="error">Current directory not found</span>');
                return;
            }
            
            const contents = filesystem[currentDir].contents;
            if (Object.keys(contents).length === 0) {
                addOutput('Directory is empty');
            } else {
                addOutput(currentDir !== '/' ? `Directory of ${currentDir}\n` : '');
                for (const [name, item] of Object.entries(contents)) {
                    const type = item.type === 'directory' ? '<DIR>' : '<FILE>';
                    addOutput(`${type.padEnd(15)}${name}`);
                }
            }
        }
        
        function changeDirectory(path) {
            if (!path) {
                addOutput(currentDir);
                return;
            }
            
            const newPath = normalizePath(path);
            if (filesystem[newPath] && filesystem[newPath].type === 'directory') {
                currentDir = newPath;
            } else {
                addOutput('<span class="error">Directory not found</span>');
            }
        }
        
        function makeDirectory(name) {
            if (!name) {
                addOutput('Usage: mkdir <directory_name>');
                return;
            }
            
            const newPath = normalizePath(name);
            if (filesystem[newPath]) {
                addOutput(`<span class="error">Directory '${name}' already exists</span>`);
                return;
            }
            
            const parentPath = getParentPath(newPath);
            if (!filesystem[parentPath]) {
                addOutput('<span class="error">Parent directory not found</span>');
                return;
            }
            
            const dirName = newPath.split('/').filter(Boolean).pop();
            filesystem[newPath] = { type: 'directory', contents: {} };
            filesystem[parentPath].contents[dirName] = { type: 'directory', contents: {} };
            addOutput(`Directory '${name}' created`);
        }
        
        function removeDirectory(name) {
            if (!name) {
                addOutput('Usage: rmdir <directory_name>');
                return;
            }
            
            const targetPath = normalizePath(name);
            if (!filesystem[targetPath] || filesystem[targetPath].type !== 'directory') {
                addOutput('<span class="error">Directory not found</span>');
                return;
            }
            
            if (Object.keys(filesystem[targetPath].contents).length > 0) {
                addOutput('<span class="error">Directory is not empty</span>');
                return;
            }
            
            delete filesystem[targetPath];
            const parentPath = getParentPath(targetPath);
            const dirName = targetPath.split('/').filter(Boolean).pop();
            delete filesystem[parentPath].contents[dirName];
            addOutput(`Directory '${name}' removed`);
        }
        
        function createTextFile(name) {
            if (!name) {
                addOutput('Usage: mktf <filename>');
                return;
            }
            
            multilineMode = true;
            multilineFilename = name;
            multilineType = 'txt';
            addOutput(`Write your text for '${name}' and type '\\s' on a new line to save.`);
        }
        
        function createExeFile(name) {
            if (!name) {
                addOutput('Usage: mkef <filename>');
                return;
            }
            
            multilineMode = true;
            multilineFilename = name;
            multilineType = 'exe';
            addOutput(`Write your code for '${name}' and type '\\s' on a new line to save.`);
        }
        
        function saveMultilineFile() {
            const content = multilineBuffer.join('\n');
            const filePath = joinPath(currentDir, multilineFilename);
            
            fileContents[filePath] = {
                type: multilineType,
                content: content,
                created_in: currentDir
            };
            
            filesystem[currentDir].contents[multilineFilename] = { type: 'file' };
            addOutput(`<span class="success">File '${multilineFilename}' created successfully</span>`);
        }
        
        function viewFile(name) {
            if (!name) {
                addOutput('Usage: vwtf <filename>');
                return;
            }
            
            const filePath = joinPath(currentDir, name);
            if (fileContents[filePath]) {
                addOutput(fileContents[filePath].content);
            } else {
                addOutput('<span class="error">File not found</span>');
            }
        }
        
        function removeFile(name) {
            if (!name) {
                addOutput('Usage: rm <filename>');
                return;
            }
            
            if (name === 'all') {
                const files = Object.keys(filesystem[currentDir].contents).filter(
                    n => filesystem[currentDir].contents[n].type === 'file'
                );
                files.forEach(f => {
                    const fp = joinPath(currentDir, f);
                    delete fileContents[fp];
                    delete filesystem[currentDir].contents[f];
                });
                addOutput('All files removed');
                return;
            }
            
            const filePath = joinPath(currentDir, name);
            if (fileContents[filePath]) {
                delete fileContents[filePath];
                delete filesystem[currentDir].contents[name];
                addOutput(`File '${name}' deleted`);
            } else {
                addOutput('<span class="error">File not found</span>');
            }
        }
        
        function copyFile(args) {
            const match = args.match(/(.+?)\s+to\s+(.+)/i);
            if (!match) {
                addOutput('Usage: copy <filename> to <directory>');
                return;
            }
            
            const [, filename, targetPath] = match;
            const sourcePath = joinPath(currentDir, filename.trim());
            const targetDir = normalizePath(targetPath.trim());
            
            if (!fileContents[sourcePath]) {
                addOutput('<span class="error">Source file not found</span>');
                return;
            }
            
            if (!filesystem[targetDir]) {
                addOutput('<span class="error">Target directory not found</span>');
                return;
            }
            
            const targetFile = joinPath(targetDir, filename.trim());
            fileContents[targetFile] = { ...fileContents[sourcePath], created_in: targetDir };
            filesystem[targetDir].contents[filename.trim()] = { type: 'file' };
            addOutput(`<span class="success">File '${filename.trim()}' copied to ${targetDir}</span>`);
        }
        
        function moveFile(args) {
            const match = args.match(/(.+?)\s+to\s+(.+)/i);
            if (!match) {
                addOutput('Usage: move <filename> to <directory>');
                return;
            }
            
            const [, filename, targetPath] = match;
            const sourcePath = joinPath(currentDir, filename.trim());
            const targetDir = normalizePath(targetPath.trim());
            
            if (!fileContents[sourcePath]) {
                addOutput('<span class="error">Source file not found</span>');
                return;
            }
            
            if (!filesystem[targetDir]) {
                addOutput('<span class="error">Target directory not found</span>');
                return;
            }
            
            const targetFile = joinPath(targetDir, filename.trim());
            fileContents[targetFile] = { ...fileContents[sourcePath], created_in: targetDir };
            filesystem[targetDir].contents[filename.trim()] = { type: 'file' };
            delete fileContents[sourcePath];
            delete filesystem[currentDir].contents[filename.trim()];
            addOutput(`<span class="success">File '${filename.trim()}' moved to ${targetDir}</span>`);
        }
        
        function renameFile(args) {
            const match = args.match(/(.+?)\s+to\s+(.+)/i);
            if (!match) {
                addOutput('Usage: rem <oldname> to <newname>');
                return;
            }
            
            const [, oldName, newName] = match;
            const oldPath = joinPath(currentDir, oldName.trim());
            const newPath = joinPath(currentDir, newName.trim());
            
            if (!fileContents[oldPath]) {
                addOutput('<span class="error">File not found</span>');
                return;
            }
            
            if (fileContents[newPath]) {
                addOutput('<span class="error">File already exists</span>');
                return;
            }
            
            fileContents[newPath] = fileContents[oldPath];
            delete fileContents[oldPath];
            filesystem[currentDir].contents[newName.trim()] = { type: 'file' };
            delete filesystem[currentDir].contents[oldName.trim()];
            addOutput(`<span class="success">'${oldName.trim()}' renamed to '${newName.trim()}'</span>`);
        }
        
        function editFile(name) {
            if (!name) {
                addOutput('Usage: edit <filename>');
                return;
            }
            
            const filePath = joinPath(currentDir, name);
            if (!fileContents[filePath]) {
                addOutput('<span class="error">File not found</span>');
                return;
            }
            
            multilineMode = true;
            multilineFilename = name;
            multilineType = fileContents[filePath].type;
            multilineBuffer = fileContents[filePath].content.split('\n');
            
            addOutput(`Edit your content for '${name}' and type '\\s' on a new line to save.`);
            addOutput('Current content:');
            addOutput(fileContents[filePath].content);
            addOutput('--- Continue editing below ---');
        }
        
        function formatFilesystem() {
            filesystem = {
                '/': {
                    type: 'directory',
                    contents: {
                        'bin': { type: 'directory', contents: {} },
                        'usr': { type: 'directory', contents: {} },
                        'tmp': { type: 'directory', contents: {} }
                    }
                }
            };
            fileContents = {};
            currentDir = '/';
            commandHistory = [];
            addOutput('Filesystem formatted successfully');
        }
        
        // Utility functions
        function normalizePath(path) {
            let parts;
            if (path.startsWith('/')) {
                parts = path.split('/').filter(Boolean);
            } else {
                parts = currentDir.split('/').filter(Boolean);
                parts.push(...path.split('/').filter(Boolean));
            }
            
            const normalized = [];
            for (const part of parts) {
                if (part === '..') {
                    normalized.pop();
                } else if (part !== '.') {
                    normalized.push(part);
                }
            }
            
            return normalized.length ? '/' + normalized.join('/') : '/';
        }
        
        function getParentPath(path) {
            const parts = path.split('/').filter(Boolean);
            parts.pop();
            return parts.length ? '/' + parts.join('/') : '/';
        }
        
        function joinPath(base, name) {
            return base === '/' ? '/' + name : base + '/' + name;
        }
        
        function addOutput(text) {
            const line = document.createElement('div');
            line.className = 'line';
            line.innerHTML = text;
            output.appendChild(line);
        }
        
        function updatePrompt() {
            const path = currentDir === '/' ? '\\' : currentDir.replace(/\//g, '\\');
            promptElement.textContent = `PY DOS ${path}> `;
        }
        
        function scrollToBottom() {
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        function saveToStorage() {
            localStorage.setItem('pydos_filesystem', JSON.stringify(filesystem));
            localStorage.setItem('pydos_filecontents', JSON.stringify(fileContents));
            localStorage.setItem('pydos_currentdir', currentDir);
            localStorage.setItem('pydos_history', JSON.stringify(commandHistory.slice(-10)));
        }
        
        function loadFromStorage() {
            const savedFS = localStorage.getItem('pydos_filesystem');
            const savedFC = localStorage.getItem('pydos_filecontents');
            const savedCD = localStorage.getItem('pydos_currentdir');
            const savedHist = localStorage.getItem('pydos_history');
            
            if (savedFS) filesystem = JSON.parse(savedFS);
            if (savedFC) fileContents = JSON.parse(savedFC);
            if (savedCD) currentDir = savedCD;
            if (savedHist) commandHistory = JSON.parse(savedHist);
            
            updatePrompt();
        }
        
        // Initial focus
        commandInput.focus();
    </script>
</body>
</html>